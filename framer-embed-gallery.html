<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>Flickr Gallery - Framer Embed</title>
    <style>
        /* 
        üé® FRAMER EMBED CUSTOMIZATION GUIDE
        ===================================
        
        üìê LAYOUT & SIZE:
        - .gallery-container: Controls overall gallery container
        - .gallery-grid grid-template-columns: Changes number of columns (repeat(4, 1fr) = 4 columns)
        - .gallery-grid gap: Space between photos
        
        üìù FONTS & TEXT:
        - h2 font-size: Filter title size (inherits from Framer if not set)
        - .filter-tag font-size: Filter button text size  
        
        üé® COLORS:
        - Uses inherit where possible to match your Framer theme
        - .filter-tag color: Filter text color
        - .filter-tag.active color: Selected filter color
        
        üì± MOBILE:
        - @media breakpoints: 768px, 480px, 320px
        - Mobile grid-template-columns: 2 columns on mobile
        
        ‚öôÔ∏è FLICKR CONFIG (in JavaScript at bottom):
        - apiKey: Your Flickr API key
        - albumId: Your specific album ID  
        - userId: Your Flickr user ID
        */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* üñºÔ∏è MAIN CONTAINER - Framer optimized */
        .gallery-container {
            width: 100%;              /* üìè Full width to fit Framer container */
            min-height: 100vh;        /* üìè Ensure sufficient height for sticky behavior */
            margin: 0;                /* No auto margins for embed */
            padding: 0;               /* üì¶ No padding - let Framer control spacing */
            font-family: inherit;     /* üìù Inherit Framer's font */
            color: inherit;           /* üé® Inherit Framer's text color */
            position: relative;       /* üìç Establish positioning context */
        }

        /* üìã FILTER SECTION - ROBUST STICKY */
        .filter-container {
            position: fixed;         /* üìå Fixed to top for reliable sticking */
            position: -webkit-sticky; /* üçé Safari fallback */
            top: 0;                  /* üìè Stick to very top */
            left: 0;                 /* üìè Ensure proper positioning */
            right: 0;                /* üìè Full width */
            z-index: 1000;           /* üìè Above photos but below lightbox */
            background: linear-gradient(180deg, 
                        rgba(255,255,255,0.95) 0%, 
                        rgba(255,255,255,0.9) 80%, 
                        rgba(255,255,255,0.7) 100%); /* üé® Subtle gradient background */
            backdrop-filter: blur(10px); /* üé™ Modern blur effect */
            -webkit-backdrop-filter: blur(10px); /* üçé Safari support */
            padding: 15px 0;         /* üì¶ Padding around filters */
            margin-bottom: 20px;     /* üìè Space below filters */
            text-align: center;      /* Center filter elements */
            border-bottom: 1px solid rgba(0,0,0,0.1); /* üìè Subtle bottom border */
            transition: all 0.3s ease; /* üé≠ Smooth transitions */
            /* Ensure sticky behavior works */
            width: 100%;
            box-sizing: border-box;
        }

        /* üì± FORCE MOBILE STICKY BEHAVIOR */
        @media screen and (max-width: 768px) {
            .filter-container {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                z-index: 1000 !important;
                width: 100% !important;
                padding: 8px 0 !important; /* Reduced padding for mobile */
                margin-bottom: 10px !important; /* Reduced margin */
                /* Additional mobile-specific fixes */
                transform: translateZ(0); /* Force hardware acceleration */
                will-change: transform;   /* Optimize for position changes */
            }
            
            .filter-tags {
                gap: 5px !important; /* Reduced spacing for mobile */
            }
            
            .filter-tag {
                padding: 4px 8px !important; /* Smaller padding on mobile */
                font-size: 14px !important; /* Smaller font size */
            }
        }

        /*  Enhanced sticky state */
        .filter-container.scrolled {
            background: rgba(255,255,255,0.98); /* üé® More opaque when scrolled */
            box-shadow: 0 2px 20px rgba(0,0,0,0.1); /* üìè Soft shadow */
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;              /* üìè Space between filter items */
        }

        /* üè∑Ô∏è FILTER TAGS - Text style for Framer */
        .filter-tag {
            background: none;        /* No background - just text */
            border: none;           /* No border */
            padding: 8px 12px;      /* üì¶ Padding around text */
            cursor: pointer;
            font-size: inherit;     /* üìù Inherit Framer font size */
            color: inherit;         /* üé® Inherit Framer text color */
            text-decoration: none;
            transition: opacity 0.2s ease;
            font-family: inherit;
        }

        .filter-tag:hover {
            opacity: 0.7;           /* üé® Subtle hover effect */
        }

        .filter-tag.active {
            color: #DFFF00;         /* üé® Active filter color - chartreuse */
            font-weight: bold;      /* Make active filters bold */
        }

        /* ‚ûñ FILTER SEPARATORS */
        .filter-separator {
            color: inherit;         /* üé® Match text color */
            font-weight: bold;
            padding: 8px 4px;
            font-size: inherit;
        }

        /* üñºÔ∏è PHOTO GRID */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);  /* üìê 4 columns desktop - change number for different layout */
            gap: 4px;                               /* üìè Gap between photos - adjust spacing */
            width: 100%;
            margin-top: 80px; /* Add top margin to account for fixed navigation */
        }

        .photo-item {
            position: relative;
            aspect-ratio: 1;        /* üìê Square photos - change to 4/3 or 16/9 for rectangles */
            overflow: hidden;
            cursor: pointer;
            border-radius: 2px;     /* üé® Sharp, minimal corners */
            transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
            border: 1px solid rgba(0,0,0,0.05); /* ‚ùÑÔ∏è Subtle Nordic border */
        }

        .photo-item:hover {
            transform: translateY(-1px); /* ‚ùÑÔ∏è Minimal lift - no scaling */
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); /* ‚ùÑÔ∏è Clean shadow */
            border-color: rgba(0,0,0,0.1);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;      /* üìê How image fills container */
            transition: opacity 0.3s ease;
        }

        /* üîÑ ADVANCED LOADING STATES */
        .loading, .error {
            text-align: center;
            padding: 40px 20px;     /* üì¶ Padding around messages */
            font-size: inherit;     /* üìù Inherit Framer font size */
            color: inherit;         /* üé® Match Framer text color */
        }

        .error {
            color: #ff4444;         /* üé® Error color - red */
        }

        /* üíÄ SKELETON LOADING */
        .skeleton-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            padding: 20px 0;
        }

        .skeleton-item {
            aspect-ratio: 1;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .skeleton-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.4) 50%, 
                transparent 100%);
            animation: shimmerWave 2s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes shimmerWave {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* üìä LOADING PROGRESS BAR */
        .loading-progress {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(0,0,0,0.1);
            z-index: 1001;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #DFFF00, #DFFF00);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .loading-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255,255,255,0.3), 
                transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* üñºÔ∏è PROGRESSIVE IMAGE LOADING */
        .photo-item img {
            filter: blur(0px);
            transition: filter 0.6s ease, opacity 0.6s ease;
        }

        .photo-item img.loading {
            filter: blur(10px);
            opacity: 0.7;
        }

        .photo-item img.loaded {
            filter: blur(0px);
            opacity: 1;
        }

        /* üé≠ STAGGERED ENTRANCE ANIMATIONS */
        .photo-item {
            opacity: 0;
            transform: translateY(30px) scale(0.95);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .photo-item.animate-in {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* üì± MOBILE SKELETON ADJUSTMENTS */
        @media screen and (max-width: 768px) {
            .skeleton-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
        }

        @media screen and (max-width: 480px) {
            .skeleton-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
        }

        /* üñºÔ∏è LIGHTBOX WITH MODERN ANIMATIONS */
        .lightbox {
            display: none;
            position: fixed;
            z-index: 9999;          /* üìè High z-index to appear above Framer content */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0);  /* Start transparent */
            transition: background-color 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .lightbox.show {
            background-color: rgba(0,0,0,0.8);  /* üé® Overlay darkness */
        }

        .lightbox-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.3);
            /* Remove padding to eliminate transparent click area */
            padding: 0;
            /* Size is now determined by the image itself */
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            opacity: 0;
            /* Display inline-block so it wraps tightly around image */
            display: inline-block;
        }

        .lightbox-content.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .lightbox-content img {
            display: block;         /* Remove any inline spacing */
            max-width: 85vw;        /* More conservative for smaller screens */
            max-height: 70vh;       /* More conservative to prevent cropping */
            width: auto;
            height: auto;
            object-fit: contain;    /* Ensures entire image is visible without cropping */
            border-radius: 12px;    /* üé® More rounded corners */
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        /* Mobile image sizing */
        @media screen and (max-width: 768px) {
            .lightbox-content img {
                max-height: 60vh;    /* More conservative for mobile */
                max-width: 85vw;     /* More conservative mobile width */
            }
        }

        /* Very small screens */
        @media screen and (max-width: 480px) {
            .lightbox-content {
                max-height: 65vh !important;  /* Even more conservative */
                max-width: 95vw !important;   /* Use more width on tiny screens */
            }
            
            .lightbox-content img {
                max-height: 55vh;    /* Very conservative for small screens */
                max-width: 90vw;     /* Use more available width */
            }
        }

        .lightbox-content img:hover {
            /* Hover zoom removed to prevent scrollbar creation */
            transform: none;
        }

        .close {
            position: absolute;
            top: -15px;             /* üìç Position above the image */
            right: -15px;           /* üìç Position to the right of the image */
            color: white;
            font-size: 30px;        /* üìù Slightly smaller close button */
            font-weight: bold;
            cursor: pointer;
            z-index: 10001;         /* Above the image */
            width: 40px;            /* üìè Close button width */
            height: 40px;           /* üìè Close button height */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0,0,0,0.7);  /* üé® Darker background for visibility */
            border: 2px solid rgba(255,255,255,0.2); /* Subtle white border */
            transition: all 0.2s ease;
        }

        .close:hover {
            background-color: rgba(0,0,0,0.9);  /* üé® Close button hover color */
            border-color: rgba(255,255,255,0.4); /* Brighter border on hover */
            transform: scale(1.1);   /* Slight grow on hover */
        }

        /* üéØ ENHANCED LIGHTBOX FEATURES */
        
        /* Simplified lightbox - no gestures */
        .lightbox-content {
            user-select: none;
        }

        .lightbox-content img {
            cursor: default;
            touch-action: none; /* Prevent all touch gestures including zoom */
            user-select: none; /* Prevent selection */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            pointer-events: auto; /* Keep click events but disable gestures */
            max-width: 85vw !important; /* Force max width */
            max-height: 70vh !important; /* Force max height */
            width: auto !important;
            height: auto !important;
            transform: none !important; /* Prevent any transforms */
            zoom: 1 !important; /* Prevent CSS zoom */
        }

        /* üé≠ MODERN MOTION GRAPHICS ANIMATIONS */
        .photo-item {
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); /* üé™ Bouncy easing */
        }

        .fade-in {
            animation: nordicFadeIn 0.4s cubic-bezier(0.25, 0.1, 0.25, 1); /* Perfect ease curve */
        }

        .fade-out {
            animation: nordicFadeOut 0.25s cubic-bezier(0.4, 0, 0.6, 1); /* Sharp, precise exit */
        }

        .scale-bounce {
            animation: scaleBounce 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .slide-up {
            animation: slideUpBounce 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .wobble {
            animation: wobbleIn 0.8s cubic-bezier(0.36, 0, 0.66, -0.56);
        }

        /* ‚ùÑÔ∏è Nordic precision fade - cold and calculated */
        @keyframes nordicFadeIn {
            0% { 
                opacity: 0; 
                transform: translateY(2px) scale(0.98);
                filter: contrast(1.1) brightness(0.95);
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1);
                filter: contrast(1) brightness(1);
            }
        }

        /* ‚ùÑÔ∏è Nordic fade out - clean disappearance */
        @keyframes nordicFadeOut {
            0% { 
                opacity: 1; 
                transform: scale(1);
                filter: contrast(1) brightness(1);
            }
            100% { 
                opacity: 0; 
                transform: scale(0.95) translateY(-1px);
                filter: contrast(0.9) brightness(1.05);
            }
        }

        /* üéØ Bouncy scale animation */
        @keyframes scaleBounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            75% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        /* üöÄ Slide up with bounce */
        @keyframes slideUpBounce {
            0% { 
                opacity: 0;
                transform: translateY(100px) scale(0.8);
            }
            60% { 
                opacity: 0.8;
                transform: translateY(-10px) scale(1.05);
            }
            100% { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* üåä Wobble entrance */
        @keyframes wobbleIn {
            0% { 
                opacity: 0;
                transform: translateX(-50px) rotate(-10deg) scale(0.5);
            }
            30% { 
                opacity: 0.5;
                transform: translateX(15px) rotate(5deg) scale(1.1);
            }
            60% { 
                opacity: 0.8;
                transform: translateX(-8px) rotate(-2deg) scale(0.95);
            }
            100% { 
                opacity: 1;
                transform: translateX(0) rotate(0deg) scale(1);
            }
        }

        /* ‚ùÑÔ∏è Nordic filter button precision */
        .filter-tag {
            position: relative;
            transition: all 0.2s cubic-bezier(0.25, 0.1, 0.25, 1);
            border-bottom: 1px solid transparent;
            cursor: pointer;
            overflow: hidden;
            color: #333333; /* Dark text for better visibility */
        }

        .filter-tag:hover {
            opacity: 0.7;
            border-bottom-color: rgba(0,0,0,0.2); /* ‚ùÑÔ∏è Minimal underline */
            transform: translateY(-2px); /* Subtle lift */
            color: #000000; /* Darker on hover */
        }

        .filter-tag.active {
            opacity: 1;
            border-bottom-color: #000; /* ‚ùÑÔ∏è Sharp black line */
            font-weight: 500; /* ‚ùÑÔ∏è Slightly bolder */
            color: #000000; /* Black for active state */
        }

        /* üé≠ ENHANCED MICRO-ANIMATIONS */
        
        /* üîÑ FILTER MORPHING ANIMATIONS */
        .filter-tags {
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .filter-tag {
            transform-origin: center;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .filter-tag::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(0,0,0,0.1), transparent 70%);
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: inherit;
        }

        .filter-tag:hover::before {
            opacity: 1;
            transform: scale(1);
        }

        .filter-tag:active {
            transform: scale(0.95);
        }

        /* üéØ ELASTIC BUTTON FEEDBACK */
        .filter-tag.clicked {
            animation: elasticClick 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes elasticClick {
            0% { transform: scale(1); }
            30% { transform: scale(0.85); }
            60% { transform: scale(1.1); }
            80% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        /* üåä SMOOTH PAGE TRANSITIONS */
        .gallery-grid {
            transition: all 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        .gallery-transition-enter {
            opacity: 0;
            transform: translateY(20px);
        }

        .gallery-transition-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .gallery-transition-exit {
            opacity: 1;
            transform: translateY(0);
        }

        .gallery-transition-exit-active {
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.6, 1);
        }

        /* üÉè PHOTO FLIP CARDS */
        .photo-item {
            perspective: 1000px;
            transform-style: preserve-3d;
        }

        .photo-card {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s cubic-bezier(0.25, 0.1, 0.25, 1);
            transform-style: preserve-3d;
        }

        .photo-card.flipped {
            transform: rotateY(180deg);
        }

        .photo-front, .photo-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            overflow: hidden;
        }

        .photo-back {
            transform: rotateY(180deg);
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 15px;
            text-align: center;
            color: #495057;
        }

        .photo-back h4 {
            font-size: 0.9em;
            margin: 0 0 10px 0;
            font-weight: 600;
        }

        .photo-back p {
            font-size: 0.7em;
            opacity: 0.8;
            margin: 5px 0;
        }

        .photo-back .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 10px;
        }

        .photo-back .tag {
            background: rgba(0,0,0,0.1);
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 0.6em;
        }

        /* üéà ENHANCED HOVER EFFECTS */
        .photo-item:hover .photo-card {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .photo-item:hover img {
            filter: brightness(1.1) contrast(1.05);
        }

        /*  MOBILE MICRO-ANIMATION ADJUSTMENTS */
        @media screen and (max-width: 768px) {
            .filter-tag:hover {
                transform: none; /* Disable hover lift on mobile */
            }

            .photo-item:hover .photo-card {
                transform: none; /* Disable hover effects on mobile */
                box-shadow: none;
            }

            .photo-item:hover img {
                filter: none; /* Disable image filters on mobile */
            }

            /* Reduce motion for mobile */
            .filter-tag {
                transition: all 0.2s ease;
            }

            .photo-card {
                transition: transform 0.4s ease;
            }
        }

        /* üé™ Loading animation upgrade */
        .loading {
            position: relative;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(223,255,0,0.3);
            border-radius: 50%;
            border-top-color: #DFFF00;
            animation: modernSpin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes modernSpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        /* üì± MOBILE RESPONSIVE BREAKPOINTS */
        @media (max-width: 768px) { /* üîß Tablet breakpoint */
            .gallery-grid {
                grid-template-columns: repeat(3, 1fr); /* üìê 3 columns on tablet */
                gap: 3px;                              /* üìè Smaller gap on tablet */
            }
            
            .lightbox-content {
                padding: 10px;         /* üì¶ Less padding on tablet */
                width: 95%;            /* üì± More width on tablet */
            }

            .filter-tags {
                gap: 8px;              /* üìè Smaller gap between filters */
            }
        }

        @media (max-width: 480px) { /* üîß Mobile breakpoint */
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr); /* üìê 2 columns on mobile */
                gap: 2px;                              /* üìè Minimal gap on mobile */
            }

            .filter-tag {
                padding: 8px 12px;     /* üì¶ Touch-friendly padding on mobile */
                font-size: 16px;       /* üìù Larger text for mobile readability */
                min-height: 44px;      /* üì± iOS recommended touch target */
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .filter-tags {
                gap: 12px;             /* üìè More space for fat fingers */
                flex-wrap: wrap;
            }

            /* üì± Sticky filters on mobile */
            .filter-container {
                padding: 10px 0;      /* üì¶ Less padding on mobile */
                margin-bottom: 15px;   /* üìè Less margin on mobile */
            }
            
            .filter-container.scrolled {
                padding: 8px 0;       /* üì¶ Even more compact when scrolled */
            }

            /* üì± Reduce animation intensity on mobile for performance */
            .photo-item {
                transition: transform 0.2s ease; /* Faster transitions */
            }
            
            .fade-in {
                animation-duration: 0.2s; /* Very fast fade on mobile */
            }

            /* üì± Mobile-friendly touch states */
            .photo-item:active {
                transform: scale(0.95);
                transition: transform 0.1s ease;
            }
            
            .filter-tag:active {
                transform: scale(0.95);
                background-color: rgba(223,255,0,0.1);
            }

            /* üì± Prevent accidental taps during scrolling */
            .photo-item {
                touch-action: manipulation; /* Prevents zoom on double-tap */
            }
        }

        @media (max-width: 320px) { /* üîß Small mobile breakpoint */
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr); /* üìê Still 2 columns on small mobile */
                gap: 2px;
            }
            
            .close {
                top: -10px;            /* üìç Adjust close button on small screens - relative to image */
                right: -10px;
                font-size: 26px;       /* üìù Smaller close button */
                width: 38px;           /* üì± Slightly smaller for mobile */
                height: 38px;
            }
            
            .lightbox-content {
                /* No width/padding override - let it size to image */
                padding: 0;
            }
            
            .lightbox-content img {
                border-radius: 8px;    /* üé® Less rounded on small screens */
                max-height: 85vh;      /* üì± More height for small screens */
            }
        }

        /* ÔøΩ LIGHTBOX CENTERING FIX - ALL DEVICES */
        .lightbox {
            /* Force proper positioning above everything including sticky nav */
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden !important;
            z-index: 999999 !important;
            transform: none !important;
            box-sizing: border-box !important;
            /* Prevent any scrolling on the lightbox itself */
            touch-action: none !important;
            -webkit-overflow-scrolling: touch !important;
        }
        
        .lightbox-content {
            /* Constrain to current viewport only - no document scrolling */
            position: fixed !important;
            top: 50vh !important;          /* Center vertically in viewport */
            left: 50vw !important;
            transform: translate(-50%, -50%) scale(0.3) !important;  /* Center both ways */
            max-height: 70vh !important;   /* Conservative height to prevent cropping */
            max-width: 85vw !important;    /* Conservative width for smaller screens */
            margin: 0 !important;
            overflow: hidden !important;   /* Prevent any overflow scrolling */
            z-index: 1000000 !important;
            box-sizing: border-box !important;
            display: block !important;
        }
        
        .lightbox-content.show {
            transform: translate(-50%, -50%) scale(1) !important;  /* Center both ways */
        }

        /* Mobile specific positioning */
        @media screen and (max-width: 768px) {
            .lightbox-content {
                top: 160px !important;        /* Fixed distance from top on mobile */
                transform: translate(-50%, 0) scale(0.3) !important; /* Only center horizontally */
                max-height: 70vh !important;  /* Conservative height for mobile */
                max-width: 90vw !important;   /* Conservative width for mobile */
            }
            
            .lightbox-content.show {
                transform: translate(-50%, 0) scale(1) !important; /* Only center horizontally */
            }
        }

        /* üì± MOBILE TOUCH OPTIMIZATIONS */
        @media (hover: none) and (pointer: coarse) {
            /* This targets touch devices */
            .photo-item:hover {
                transform: none;       /* Disable hover effects on touch devices */
            }
            
            .filter-tag:hover::before {
                width: 0;              /* Disable hover ripple on touch */
                height: 0;
            }
            
            .filter-tag:hover {
                transform: none;       /* Disable hover lift on touch */
            }
        }

        /* üåå ATMOSPHERIC DESIGN ELEMENTS */
        
        /* üîÑ PARALLAX SCROLLING */
        .parallax-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }

        .parallax-layer {
            position: absolute;
            width: 120%;
            height: 120%;
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            filter: blur(20px) brightness(0.3);
            opacity: 0;
            transition: opacity 1s ease;
        }

        .parallax-layer.active {
            opacity: 0.4;
        }

        /* ‚ú® FLOATING PARTICLES */
        .particle-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            pointer-events: none;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: radial-gradient(circle, rgba(255,255,255,0.6), transparent);
            border-radius: 50%;
            animation: float 10s infinite linear;
        }

        .particle.large {
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, rgba(255,255,255,0.4), transparent);
            animation-duration: 15s;
        }

        .particle.medium {
            width: 3px;
            height: 3px;
            background: radial-gradient(circle, rgba(255,255,255,0.5), transparent);
            animation-duration: 12s;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0px);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-20px) translateX(var(--random-x, 0px));
                opacity: 0;
            }
        }

        /* üé® DYNAMIC COLOR THEMING */
        .gallery-container {
            transition: background-color 2s ease;
        }

        .gallery-container.theme-warm {
            background: linear-gradient(135deg, 
                rgba(255, 245, 235, 0.3), 
                rgba(255, 235, 215, 0.2));
        }

        .gallery-container.theme-cool {
            background: linear-gradient(135deg, 
                rgba(235, 245, 255, 0.3), 
                rgba(215, 235, 255, 0.2));
        }

        .gallery-container.theme-neutral {
            background: linear-gradient(135deg, 
                rgba(245, 245, 245, 0.3), 
                rgba(235, 235, 235, 0.2));
        }

        .gallery-container.theme-vibrant {
            background: linear-gradient(135deg, 
                rgba(255, 240, 245, 0.3), 
                rgba(240, 255, 245, 0.2));
        }

        /* üåà DYNAMIC FILTER THEMING */
        .filter-container.theme-warm {
            background: linear-gradient(180deg, 
                rgba(255,248,240,0.95) 0%, 
                rgba(255,245,235,0.9) 80%, 
                rgba(255,240,225,0.7) 100%);
        }

        .filter-container.theme-cool {
            background: linear-gradient(180deg, 
                rgba(240,248,255,0.95) 0%, 
                rgba(235,245,255,0.9) 80%, 
                rgba(225,240,255,0.7) 100%);
        }

        .filter-container.theme-neutral {
            background: linear-gradient(180deg, 
                rgba(248,248,248,0.95) 0%, 
                rgba(245,245,245,0.9) 80%, 
                rgba(240,240,240,0.7) 100%);
        }

        .filter-container.theme-vibrant {
            background: linear-gradient(180deg, 
                rgba(255,245,250,0.95) 0%, 
                rgba(250,255,245,0.9) 80%, 
                rgba(245,250,255,0.7) 100%);
        }

        /* üì± REDUCE ATMOSPHERIC EFFECTS ON MOBILE */
        @media screen and (max-width: 768px) {
            .parallax-layer {
                filter: blur(10px) brightness(0.4);
                opacity: 0;
            }

            .parallax-layer.active {
                opacity: 0.2;
            }

            .particle-container {
                display: none; /* Disable particles on mobile for performance */
            }
        }

        /* ‚ôø ACCESSIBILITY & REFINEMENT */
        
        /* üé® HIGH CONTRAST MODE */
        @media (prefers-contrast: high) {
            .gallery-container {
                background: #ffffff !important;
            }

            .filter-container {
                background: #ffffff !important;
                border: 2px solid #000000 !important;
            }

            .filter-tag {
                background: #ffffff !important;
                color: #000000 !important;
                border: 2px solid #000000 !important;
            }

            .filter-tag.active {
                background: #000000 !important;
                color: #ffffff !important;
            }

            .photo-item img {
                border: 2px solid #000000 !important;
            }

            .lightbox {
                background-color: rgba(0,0,0,0.95) !important;
            }

            .parallax-layer, .particle-container {
                display: none !important; /* Hide atmospheric effects in high contrast */
            }
        }

        /* üé≠ REDUCED MOTION SUPPORT */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }

            .parallax-layer, .particle-container {
                display: none !important; /* Hide moving elements */
            }

            .photo-item:hover .photo-card {
                transform: none !important; /* Disable hover animations */
            }

            .filter-tag::before {
                display: none !important; /* Disable ripple effects */
            }

            .photo-card {
                transition: none !important; /* Disable flip animations */
            }
        }

        /* üåô DARK MODE STYLES */
        .dark-mode,
        .dark-mode .gallery-container {
            background: #121212 !important;
            color: #ffffff !important;
        }

        .dark-mode .filter-container {
            background: linear-gradient(180deg, 
                rgba(18,18,18,0.95) 0%, 
                rgba(25,25,25,0.9) 80%, 
                rgba(30,30,30,0.7) 100%) !important;
            border-bottom: 1px solid rgba(255,255,255,0.1) !important;
        }

        .dark-mode .filter-tag {
            color: #ffffff !important;
        }

        .dark-mode .filter-tag:hover {
            color: #cccccc !important;
        }

        .dark-mode .filter-tag.active {
            color: #DFFF00 !important;
        }

        .dark-mode .filter-separator {
            color: #888888 !important;
        }

        .dark-mode .photo-item {
            background: #1e1e1e !important;
        }

        .dark-mode .lightbox {
            background-color: rgba(0,0,0,0.95) !important;
        }

        .dark-mode .lightbox-content {
            background: #121212 !important;
            border: 1px solid #333333 !important;
        }

        .dark-mode .close-btn {
            background-color: rgba(255,255,255,0.1) !important;
            color: #ffffff !important;
        }

        .dark-mode .close-btn:hover {
            background-color: rgba(255,255,255,0.2) !important;
        }

        .dark-mode .parallax-layer {
            filter: blur(15px) brightness(0.2) contrast(1.2) !important;
        }

        /* üîç SIMPLIFIED FOCUS STYLES */
        .filter-tag:focus {
            outline: 2px solid #DFFF00;
            outline-offset: 2px;
        }

        .photo-item:focus {
            outline: 2px solid #DFFF00;
            outline-offset: 2px;
        }

        .close:focus {
            outline: 2px solid #ffffff;
            outline-offset: 2px;
        }

        /* üì± ENHANCED TOUCH TARGETS */
        @media (max-width: 768px) {
            .filter-tag {
                min-height: 44px !important; /* iOS accessibility guideline */
                min-width: 44px !important;
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                padding: 12px 16px !important;
            }

            .close {
                min-height: 44px !important;
                min-width: 44px !important;
            }
        }

        /* üìñ SCREEN READER OPTIMIZATIONS */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .aria-live-region {
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        /* üéØ FOCUS WITHIN FOR IMPROVED KEYBOARD NAV */
        .filter-container:focus-within {
            outline: 2px solid #DFFF00;
            outline-offset: 2px;
        }

        .gallery-grid:focus-within {
            outline: 2px solid #DFFF00;
            outline-offset: 2px;
        }

        /* üåà THEME PREFERENCES */
        @media (prefers-color-scheme: dark) {
            .gallery-container {
                background: linear-gradient(135deg, 
                    rgba(25, 25, 25, 0.8), 
                    rgba(15, 15, 15, 0.9));
                color: #e0e0e0;
            }

            .filter-container {
                background: linear-gradient(180deg, 
                    rgba(25,25,25,0.95) 0%, 
                    rgba(20,20,20,0.9) 80%, 
                    rgba(15,15,15,0.7) 100%);
                color: #e0e0e0;
            }

            .filter-tag {
                color: #e0e0e0;
                border-bottom-color: rgba(255,255,255,0.3);
            }

            .filter-tag.active {
                border-bottom-color: #ffffff;
                color: #ffffff;
            }

            .photo-back {
                background: linear-gradient(45deg, #2a2a2a, #1a1a1a);
                color: #e0e0e0;
            }
        }
    </style>
</head>
<body class="dark-mode">
    <div class="gallery-container">
        <!-- ‚ôø Accessibility Elements -->
        <div id="ariaLive" class="aria-live-region" aria-live="polite" aria-atomic="true"></div>
        <div id="ariaStatus" class="aria-live-region" aria-live="assertive" aria-atomic="true"></div>
        
        <!-- üåå Atmospheric Elements -->
        <div class="parallax-container">
            <div id="parallaxLayer" class="parallax-layer"></div>
        </div>
        
        <div class="particle-container" id="particleContainer">
            <!-- Particles will be generated by JavaScript -->
        </div>
        
        <div class="filter-container" role="navigation" aria-label="Photo filter options">
            <div class="filter-tags" id="filterTags" role="group">
                <!-- Filter tags will be populated here -->
            </div>
        </div>
        
        <!-- üìä LOADING PROGRESS BAR -->
        <div id="loadingProgress" class="loading-progress" style="display: none;">
            <div class="loading-progress-bar" id="progressBar"></div>
        </div>
        
        <!-- üíÄ SKELETON LOADING -->
        <div id="skeletonLoading" class="skeleton-grid" style="display: none;">
            <!-- Skeleton items will be generated by JavaScript -->
        </div>
        
        <div id="loading" class="loading" style="display: none;">Loading photos...</div>
        <div id="error" class="error" style="display: none;">
            Failed to load photos. Please check your Flickr API configuration.
        </div>
        
        <div class="gallery-grid" id="gallery" role="grid" aria-label="Photography gallery">
            <!-- Photos will be populated here -->
        </div>
    </div>

    <!-- Simplified Lightbox -->
    <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-hidden="true">
        <span class="close" id="closeLightbox" role="button" aria-label="Close photo viewer">&times;</span>
        
        <div class="lightbox-content">
            <img id="lightboxImg" src="" alt="">
        </div>
    </div>

    <script>
        class FlickrGallery {
            constructor() {
                /* ‚öôÔ∏è MAIN CONFIGURATION - Change these for your Flickr account */
                this.apiKey = 'cfa92568a91ee1d02ecb512ae6eeb541'; // üîë Your Flickr API key
                this.albumId = '72177720330059990'; // üìÅ Your specific album/photoset ID
                this.userId = '202863354@N08'; // üë§ Your Flickr user ID
                this.photos = [];
                this.filteredPhotos = [];
                this.allTags = new Set();
                this.activeTags = new Set();
                
                this.init();
            }

            init() {
                this.isMobile = window.innerWidth <= 480;
                this.setupEventListeners();
                this.setupStickyFilters();
                this.initAtmosphericEffects();
                this.initAccessibility();
                this.loadPhotos();
                
                // Listen for orientation changes
                window.addEventListener('resize', () => {
                    this.isMobile = window.innerWidth <= 480;
                });
            }

            setupStickyFilters() {
                const filterContainer = document.querySelector('.filter-container');
                let isScrolled = false;
                let isMobile = window.innerWidth <= 768;
                
                // Enhanced sticky monitoring with mobile-first approach
                const checkStickyBehavior = () => {
                    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    const rect = filterContainer.getBoundingClientRect();
                    
                    // More aggressive mobile sticky enforcement
                    if (isMobile) {
                        // On mobile, always force fixed positioning when scrolled
                        if (scrollTop > 50) {
                            if (filterContainer.style.position !== 'fixed') {
                                console.log('Mobile: Forcing fixed navigation');
                                filterContainer.style.position = 'fixed';
                                filterContainer.style.top = '0';
                                filterContainer.style.left = '0';
                                filterContainer.style.right = '0';
                                filterContainer.style.width = '100%';
                                filterContainer.style.zIndex = '1000';
                                filterContainer.style.boxSizing = 'border-box';
                            }
                        } else if (scrollTop <= 50) {
                            // Only restore sticky when very close to top
                            filterContainer.style.position = 'sticky';
                            filterContainer.style.left = '';
                            filterContainer.style.right = '';
                        }
                    } else {
                        // Desktop behavior - check if filter should be at top but isn't
                        if (scrollTop > 100 && rect.top > 10) {
                            console.log('Desktop: Sticky nav unstuck - forcing position');
                            filterContainer.style.position = 'fixed';
                            filterContainer.style.top = '0';
                            filterContainer.style.left = '0';
                            filterContainer.style.right = '0';
                            filterContainer.style.width = '100%';
                            filterContainer.style.zIndex = '1000';
                        } else if (scrollTop <= 100 && filterContainer.style.position === 'fixed') {
                            // Restore normal sticky when back at top
                            filterContainer.style.position = 'sticky';
                            filterContainer.style.left = '';
                            filterContainer.style.right = '';
                        }
                    }
                    
                    // Original scrolled class logic
                    if (scrollTop > 20 && !isScrolled) {
                        filterContainer.classList.add('scrolled');
                        isScrolled = true;
                    } else if (scrollTop <= 20 && isScrolled) {
                        filterContainer.classList.remove('scrolled');
                        isScrolled = false;
                    }
                };
                
                // Monitor scroll with throttling for performance
                let ticking = false;
                window.addEventListener('scroll', () => {
                    if (!ticking) {
                        requestAnimationFrame(() => {
                            checkStickyBehavior();
                            ticking = false;
                        });
                        ticking = true;
                    }
                });
                
                // Update mobile detection on resize
                window.addEventListener('resize', () => {
                    isMobile = window.innerWidth <= 768;
                    checkStickyBehavior();
                });
            }

            setupEventListeners() {
                // Lightbox events
                document.getElementById('closeLightbox').onclick = () => this.closeLightbox();
                document.getElementById('lightbox').onclick = (e) => {
                    if (e.target.id === 'lightbox') this.closeLightbox();
                };
                
                // Keyboard events
                document.onkeydown = (e) => {
                    if (e.key === 'Escape') this.closeLightbox();
                };
            }

            async loadPhotos() {
                try {
                    console.log('üîÑ Starting to load photos from Flickr...');
                    console.log('Configuration:', {
                        apiKey: this.apiKey,
                        albumId: this.albumId,
                        userId: this.userId
                    });
                    
                    // Show advanced loading states
                    this.showAdvancedLoading();
                    
                    const photos = await this.fetchFlickrPhotos();
                    this.processPhotos(photos);
                } catch (error) {
                    console.error('‚ùå Error loading Flickr photos:', error);
                    console.error('Error details:', {
                        message: error.message,
                        stack: error.stack
                    });
                    this.showError();
                }
            }

            // Flickr API call using JSONP to avoid CORS issues
            async fetchFlickrPhotos() {
                return new Promise((resolve, reject) => {
                    console.log('üåê Making Flickr API call...');
                    
                    // Add timestamp to prevent caching issues
                    const timestamp = Date.now();
                    const callbackName = `flickrCallback_${timestamp}`;
                    
                    // Create global callback function
                    window[callbackName] = (data) => {
                        console.log('üì° Flickr API response received:', data);
                        
                        // Debug: Check if we're getting tags in the response
                        if (data.stat === 'ok' && data.photoset && data.photoset.photo) {
                            console.log('‚úÖ API call successful!');
                            console.log(`üì∏ Found ${data.photoset.photo.length} photos`);
                            console.log('üìã Album title:', data.photoset.title);
                            console.log('üè∑Ô∏è Sample photo data:', data.photoset.photo[0]);
                            if (data.photoset.photo[0]) {
                                console.log('üè∑Ô∏è Tags in first photo:', data.photoset.photo[0].tags);
                            }
                        } else {
                            console.error('‚ùå API returned error status:', data);
                        }
                        
                        // Clean up
                        delete window[callbackName];
                        if (script.parentNode) {
                            document.head.removeChild(script);
                        }
                        
                        if (data.stat === 'ok') {
                            resolve(data.photoset.photo);
                        } else {
                            reject(new Error(`Flickr API error: ${data.message} (Code: ${data.code})`));
                        }
                    };
                    
                    // Create script element for JSONP
                    const script = document.createElement('script');
                    script.src = `https://www.flickr.com/services/rest/?method=flickr.photosets.getPhotos&api_key=${this.apiKey}&photoset_id=${this.albumId}&user_id=${this.userId}&extras=tags,url_m,url_l&format=json&jsoncallback=${callbackName}&_=${timestamp}`;
                    
                    // Debug: Log the API URL being called
                    console.log('üîó Flickr API URL:', script.src);
                    
                    script.onerror = (e) => {
                        console.error('‚ùå Script loading error:', e);
                        delete window[callbackName];
                        if (script.parentNode) {
                            document.head.removeChild(script);
                        }
                        reject(new Error('Failed to load Flickr API script - check network connection'));
                    };
                    
                    console.log('üì§ Adding script to DOM...');
                    document.head.appendChild(script);
                    
                    // Set timeout for API call (increased to 15 seconds)
                    setTimeout(() => {
                        if (window[callbackName]) {
                            console.error('‚è∞ Flickr API request timed out after 15 seconds');
                            delete window[callbackName];
                            if (script.parentNode) {
                                document.head.removeChild(script);
                            }
                            reject(new Error('Flickr API request timeout - check API credentials and network'));
                        }
                    }, 15000);
                });
            }

            processPhotos(photos) {
                console.log('Processing photos:', photos);
                
                this.photos = photos.map(photo => {
                    // Debug: Log each photo's tags
                    console.log(`Photo "${photo.title}" tags:`, photo.tags);
                    
                    return {
                        id: photo.id,
                        title: photo.title,
                        url_m: photo.url_m,
                        url_l: photo.url_l || photo.url_m,
                        tags: photo.tags ? photo.tags.split(' ').filter(tag => tag.length > 0) : []
                    };
                });

                // Debug: Log processed photos with tags
                console.log('Processed photos with tags:', this.photos);

                // Shuffle the photos array
                this.shuffleArray(this.photos);

                // Extract all unique tags
                this.photos.forEach(photo => {
                    photo.tags.forEach(tag => this.allTags.add(tag));
                });

                // Debug: Log all found tags
                console.log('All unique tags found:', Array.from(this.allTags));

                // If no tags found, create some basic categories based on photo titles/descriptions
                if (this.allTags.size === 0) {
                    console.log('No tags found, creating basic categories...');
                    this.createBasicCategories();
                }

                this.filteredPhotos = [...this.photos];
                
                this.hideLoading();
                this.renderFilterTags();
                this.renderGallery();
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            createBasicCategories() {
                // Create simple categories and assign them to photos
                const categories = ['recent', 'featured', 'collection'];
                
                this.photos.forEach((photo, index) => {
                    // Assign categories in a rotating pattern
                    const categoryIndex = index % categories.length;
                    photo.tags = [categories[categoryIndex]];
                    this.allTags.add(categories[categoryIndex]);
                });
                
                console.log('Created basic categories:', Array.from(this.allTags));
            }

            renderFilterTags() {
                const filterContainer = document.getElementById('filterTags');
                const tags = Array.from(this.allTags).sort();
                
                // Clear existing filters
                filterContainer.innerHTML = '';
                
                // Create "All" filter
                const allFilter = document.createElement('span');
                allFilter.className = 'filter-tag active';
                allFilter.textContent = 'all';
                allFilter.dataset.tag = 'all';
                allFilter.addEventListener('click', () => this.filterByTag(null));
                filterContainer.appendChild(allFilter);

                // Add separator
                if (tags.length > 0) {
                    const separator = document.createElement('span');
                    separator.className = 'filter-separator';
                    separator.textContent = ' | ';
                    filterContainer.appendChild(separator);
                }

                // Create individual tag filters
                tags.forEach((tag, index) => {
                    const tagElement = document.createElement('span');
                    tagElement.className = 'filter-tag';
                    tagElement.textContent = tag;
                    tagElement.dataset.tag = tag;
                    tagElement.addEventListener('click', () => this.filterByTag(tag));
                    filterContainer.appendChild(tagElement);

                    // Add separator between tags (but not after the last one)
                    if (index < tags.length - 1) {
                        const separator = document.createElement('span');
                        separator.className = 'filter-separator';
                        separator.textContent = ' | ';
                        filterContainer.appendChild(separator);
                    }
                });
                
                // Add enhanced filter interactions
                this.enhanceFilterInteractions();
            }

            filterByTag(tag) {
                // Scroll to top when changing categories
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
                
                console.log('Filtering by tag:', tag);
                console.log('Available photos:', this.photos.length);
                
                // Clean filter state update
                document.querySelectorAll('.filter-tag').forEach(el => el.classList.remove('active'));
                
                if (tag === null) {
                    // Show all photos and reshuffle them
                    this.filteredPhotos = [...this.photos];
                    this.shuffleArray(this.filteredPhotos); // üé≤ Reshuffle all photos
                    console.log('Reshuffled all photos for fresh layout');
                    
                    const allFilter = document.querySelector('.filter-tag[data-tag="all"]');
                    if (allFilter) allFilter.classList.add('active');
                } else {
                    // Filter by tag and shuffle within category
                    this.filteredPhotos = this.photos.filter(photo => {
                        const hasTag = photo.tags.includes(tag);
                        console.log(`Photo "${photo.title}" has tag "${tag}":`, hasTag, 'Tags:', photo.tags);
                        return hasTag;
                    });
                    
                    // Shuffle the filtered results for variety
                    this.shuffleArray(this.filteredPhotos); // üé≤ Reshuffle within category
                    console.log(`Reshuffled ${this.filteredPhotos.length} photos in category "${tag}"`);
                    
                    const tagFilter = document.querySelector(`.filter-tag[data-tag="${tag}"]`);
                    if (tagFilter) tagFilter.classList.add('active');
                }

                console.log('Filtered photos:', this.filteredPhotos.length);
                
                // Update theme based on filtered content
                this.updateThemeBasedOnFilter(tag);
                
                // Update accessibility
                this.updateAccessibilityOnFilter(tag, this.filteredPhotos.length);
                
                this.renderGallery();
            }

            renderGallery() {
                console.log('Rendering gallery with', this.filteredPhotos.length, 'photos');
                const gallery = document.getElementById('gallery');
                
                // Modern exit animation - staggered fade out
                const currentPhotos = gallery.querySelectorAll('.photo-item');
                currentPhotos.forEach((photo, index) => {
                    setTimeout(() => {
                        photo.classList.add('fade-out');
                    }, index * 50); // Stagger the exit animations
                });
                
                // Wait for exit animations to complete
                setTimeout(() => {
                    gallery.innerHTML = '';
                    
                    // Progressive image loading with staggered entrance and flip cards
                    this.filteredPhotos.forEach((photo, index) => {
                        const photoElement = document.createElement('div');
                        photoElement.className = 'photo-item';
                        
                        // Create flip card structure
                        const photoCard = document.createElement('div');
                        photoCard.className = 'photo-card';
                        
                        // Front of card (image)
                        const photoFront = document.createElement('div');
                        photoFront.className = 'photo-front';
                        
                        const img = document.createElement('img');
                        img.src = photo.url_m;
                        img.alt = photo.title;
                        img.loading = 'lazy';
                        img.className = 'loading'; // Start with blur effect
                        
                        // Progressive image loading
                        img.onload = () => {
                            // Remove blur and show crisp image
                            setTimeout(() => {
                                img.classList.remove('loading');
                                img.classList.add('loaded');
                            }, 100); // Small delay for smooth transition
                        };
                        
                        photoFront.appendChild(img);
                        
                        // Back of card (metadata)
                        const photoBack = document.createElement('div');
                        photoBack.className = 'photo-back';
                        photoBack.innerHTML = `
                            <h4>${photo.title || 'Untitled'}</h4>
                            <p><strong>ID:</strong> ${photo.id}</p>
                            <div class="tags">
                                ${photo.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                        `;
                        
                        photoCard.appendChild(photoFront);
                        photoCard.appendChild(photoBack);
                        photoElement.appendChild(photoCard);
                        
                        // Enhanced click interactions
                        this.setupPhotoInteractions(photoElement, photo, photoCard);
                        
                        gallery.appendChild(photoElement);
                        
                        // Staggered entrance animations
                        setTimeout(() => {
                            photoElement.classList.add('animate-in');
                            
                            // Add interaction enhancements after animation completes
                            setTimeout(() => {
                                if (this.isMobile) {
                                    // Mobile: Touch-based interactions with scroll protection
                                    photoElement.style.transition = 'transform 0.2s ease';
                                    
                                    let touchStartTime = 0;
                                    let touchStartY = 0;
                                    let hasMoved = false;
                                    
                                    photoElement.addEventListener('touchstart', (e) => {
                                        touchStartTime = Date.now();
                                        touchStartY = e.touches[0].clientY;
                                        hasMoved = false;
                                        photoElement.style.transform = 'scale(0.95)';
                                    });
                                    
                                    photoElement.addEventListener('touchmove', (e) => {
                                        const touchY = e.touches[0].clientY;
                                        const moveDistance = Math.abs(touchY - touchStartY);
                                        if (moveDistance > 10) { // 10px threshold
                                            hasMoved = true;
                                            photoElement.style.transform = 'scale(1)'; // Reset scale if scrolling
                                        }
                                    });
                                    
                                    photoElement.addEventListener('touchend', (e) => {
                                        const touchDuration = Date.now() - touchStartTime;
                                        photoElement.style.transform = 'scale(1)';
                                        
                                        // Only open lightbox if it was a quick tap without movement
                                        if (!hasMoved && touchDuration < 300) {
                                            e.preventDefault(); // Prevent any other actions
                                            setTimeout(() => this.openLightbox(photo), 50);
                                        }
                                    });
                                } else {
                                    // Desktop: Nordic precision hover
                                    photoElement.style.transition = 'all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1)';
                                    // Hover effects are handled by CSS for consistency
                                }
                            }, this.isMobile ? 400 : 600);
                        }, index * 80); // Staggered timing for smooth cascade effect
                    });
                    
                    console.log('Gallery rendered with', gallery.children.length, 'elements');
                    
                    // Update accessibility after rendering
                    setTimeout(() => {
                        this.updateAriaLabels();
                    }, 100);
                }, 400); // Wait for all exit animations
            }

            openLightbox(photo) {
                const lightbox = document.getElementById('lightbox');
                const lightboxContent = lightbox.querySelector('.lightbox-content');
                const lightboxImg = document.getElementById('lightboxImg');
                
                // Hide image immediately to prevent flash
                lightboxImg.style.opacity = '0';
                lightboxImg.style.visibility = 'hidden';
                
                // Create new image to preload
                const newImg = new Image();
                newImg.onload = () => {
                    // Once loaded, set the source and show the image
                    lightboxImg.src = newImg.src;
                    lightboxImg.alt = photo.title;
                    lightboxImg.style.visibility = 'visible';
                    lightboxImg.style.opacity = '1';
                };
                newImg.src = photo.url_l || photo.url_m;
                
                // Prevent any zoom or gesture interactions on the image
                lightboxImg.addEventListener('wheel', (e) => e.preventDefault());
                lightboxImg.addEventListener('touchstart', (e) => {
                    if (e.touches.length > 1) e.preventDefault(); // Prevent pinch
                });
                lightboxImg.addEventListener('touchmove', (e) => {
                    if (e.touches.length > 1) e.preventDefault(); // Prevent pinch zoom
                });
                lightboxImg.addEventListener('gesturestart', (e) => e.preventDefault());
                lightboxImg.addEventListener('gesturechange', (e) => e.preventDefault());
                lightboxImg.addEventListener('gestureend', (e) => e.preventDefault());
                lightboxImg.addEventListener('dblclick', (e) => e.preventDefault()); // Prevent double-click zoom
                
                // Also prevent zoom on the lightbox container
                lightbox.addEventListener('wheel', (e) => e.preventDefault());
                lightbox.addEventListener('dblclick', (e) => e.preventDefault());
                lightboxContent.addEventListener('wheel', (e) => e.preventDefault());
                lightboxContent.addEventListener('dblclick', (e) => e.preventDefault());
                
                // Show lightbox with animation
                lightbox.style.display = 'block';
                
                // Trigger animations
                setTimeout(() => {
                    lightbox.classList.add('show');
                    lightboxContent.classList.add('show');
                }, 10);
            }

            closeLightbox() {
                const lightbox = document.getElementById('lightbox');
                const lightboxContent = lightbox.querySelector('.lightbox-content');
                
                // Animate out
                lightbox.classList.remove('show');
                lightboxContent.classList.remove('show');
                
                // Hide after animation
                setTimeout(() => {
                    lightbox.style.display = 'none';
                }, 400);
            }






















            // üé≠ ENHANCED INTERACTION METHODS

            setupPhotoInteractions(photoElement, photo, photoCard) {
                let tapCount = 0;
                let flipTimeout;
                
                // Double-tap to flip card (desktop and mobile)
                photoElement.addEventListener('click', (e) => {
                    tapCount++;
                    
                    if (tapCount === 1) {
                        // Single tap - open lightbox after delay
                        setTimeout(() => {
                            if (tapCount === 1) {
                                // Only single tap - open lightbox
                                this.openLightbox(photo);
                            }
                            tapCount = 0;
                        }, 300);
                    } else if (tapCount === 2) {
                        // Double tap - flip card
                        e.preventDefault();
                        this.flipPhotoCard(photoCard);
                        tapCount = 0;
                    }
                });
                
                // Mobile-specific interactions
                if (this.isMobile) {
                    this.setupMobilePhotoInteractions(photoElement, photo, photoCard);
                } else {
                    this.setupDesktopPhotoInteractions(photoElement, photo, photoCard);
                }
            }

            setupMobilePhotoInteractions(photoElement, photo, photoCard) {
                let touchStartTime = 0;
                let touchStartY = 0;
                let hasMoved = false;
                
                photoElement.addEventListener('touchstart', (e) => {
                    touchStartTime = Date.now();
                    touchStartY = e.touches[0].clientY;
                    hasMoved = false;
                    photoCard.style.transform += ' scale(0.95)';
                });
                
                photoElement.addEventListener('touchmove', (e) => {
                    const touchY = e.touches[0].clientY;
                    const moveDistance = Math.abs(touchY - touchStartY);
                    if (moveDistance > 10) {
                        hasMoved = true;
                        photoCard.style.transform = photoCard.style.transform.replace('scale(0.95)', 'scale(1)');
                    }
                });
                
                photoElement.addEventListener('touchend', (e) => {
                    const touchDuration = Date.now() - touchStartTime;
                    photoCard.style.transform = photoCard.style.transform.replace('scale(0.95)', 'scale(1)');
                    
                    // Only trigger interactions if it was a quick tap without movement
                    if (!hasMoved && touchDuration < 300) {
                        e.preventDefault();
                    }
                });
            }

            setupDesktopPhotoInteractions(photoElement, photo, photoCard) {
                // Right-click to flip card
                photoElement.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.flipPhotoCard(photoCard);
                });
                
                // Hover effects already handled by CSS
            }

            flipPhotoCard(photoCard) {
                photoCard.classList.toggle('flipped');
                
                // Auto-flip back after 3 seconds
                setTimeout(() => {
                    photoCard.classList.remove('flipped');
                }, 3000);
            }

            enhanceFilterInteractions() {
                const filterTags = document.querySelectorAll('.filter-tag');
                
                filterTags.forEach(tag => {
                    // Add elastic click animation
                    tag.addEventListener('click', () => {
                        tag.classList.add('clicked');
                        
                        setTimeout(() => {
                            tag.classList.remove('clicked');
                        }, 600);
                    });
                    
                    // Enhanced hover effects already in CSS
                });
            }

            showAdvancedLoading() {
                // Show progress bar
                const progressContainer = document.getElementById('loadingProgress');
                const progressBar = document.getElementById('progressBar');
                progressContainer.style.display = 'block';
                
                // Create skeleton items
                this.createSkeletonItems();
                document.getElementById('skeletonLoading').style.display = 'grid';
                
                // Animate progress bar
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress > 85) progress = 85; // Don't complete until real data loads
                    progressBar.style.width = progress + '%';
                    
                    if (progress >= 85) {
                        clearInterval(interval);
                    }
                }, 100);
                
                // Store interval for cleanup
                this.progressInterval = interval;
            }

            createSkeletonItems() {
                const skeletonContainer = document.getElementById('skeletonLoading');
                skeletonContainer.innerHTML = '';
                
                // Create appropriate number of skeleton items based on screen size
                const itemCount = window.innerWidth <= 480 ? 6 : window.innerWidth <= 768 ? 8 : 12;
                
                for (let i = 0; i < itemCount; i++) {
                    const skeletonItem = document.createElement('div');
                    skeletonItem.className = 'skeleton-item';
                    
                    // Add slight delay to each skeleton for staggered appearance
                    setTimeout(() => {
                        skeletonItem.style.opacity = '1';
                    }, i * 50);
                    
                    skeletonContainer.appendChild(skeletonItem);
                }
            }

            completeProgressBar() {
                const progressBar = document.getElementById('progressBar');
                if (this.progressInterval) {
                    clearInterval(this.progressInterval);
                }
                
                // Complete the progress bar
                progressBar.style.width = '100%';
                
                // Hide progress bar after animation
                setTimeout(() => {
                    document.getElementById('loadingProgress').style.display = 'none';
                }, 500);
            }

            hideLoading() {
                // Hide all loading states
                document.getElementById('loading').style.display = 'none';
                document.getElementById('skeletonLoading').style.display = 'none';
                this.completeProgressBar();
            }

            showError() {
                // Hide all loading states
                this.hideLoading();
                
                const errorDiv = document.getElementById('error');
                errorDiv.style.display = 'block';
                
                // Add more detailed error message
                errorDiv.innerHTML = `
                    <h3>‚ùå Failed to load photos</h3>
                    <p><strong>Possible issues:</strong></p>
                    <ul>
                        <li>Flickr API key may be expired or invalid</li>
                        <li>Album ID "${this.albumId}" may be incorrect or private</li>
                        <li>User ID "${this.userId}" may be incorrect</li>
                        <li>Network connection issues</li>
                    </ul>
                    <p><strong>Current Configuration:</strong></p>
                    <p>API Key: ${this.apiKey}</p>
                    <p>Album ID: ${this.albumId}</p>
                    <p>User ID: ${this.userId}</p>
                    <p>Check browser console for more details.</p>
                `;
            }

            // üåå ATMOSPHERIC METHODS

            initAtmosphericEffects() {
                this.createFloatingParticles();
                this.setupParallaxScrolling();
                this.setupDynamicTheming();
            }

            createFloatingParticles() {
                const container = document.getElementById('particleContainer');
                if (!container || this.isMobile) return; // Skip on mobile for performance

                // Create 20 particles with random properties
                for (let i = 0; i < 20; i++) {
                    const particle = document.createElement('div');
                    particle.className = `particle ${this.getRandomParticleSize()}`;
                    
                    // Random starting position
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 10 + 's';
                    
                    // Random horizontal drift
                    particle.style.setProperty('--random-x', (Math.random() - 0.5) * 200 + 'px');
                    
                    container.appendChild(particle);
                }
            }

            getRandomParticleSize() {
                const sizes = ['', 'medium', 'large'];
                return sizes[Math.floor(Math.random() * sizes.length)];
            }

            setupParallaxScrolling() {
                const parallaxLayer = document.getElementById('parallaxLayer');
                if (!parallaxLayer) return;

                window.addEventListener('scroll', () => {
                    const scrolled = window.pageYOffset;
                    const rate = scrolled * -0.5;
                    parallaxLayer.style.transform = `translateY(${rate}px)`;
                });
            }

            setupDynamicTheming() {
                // Apply initial theme
                this.currentTheme = 'neutral';
                this.applyTheme(this.currentTheme);
            }

            analyzeImageColors(photo) {
                // Simple color analysis based on image URL and tags
                const title = photo.title.toLowerCase();
                const tags = photo.tags.join(' ').toLowerCase();
                
                if (tags.includes('sunset') || tags.includes('warm') || tags.includes('golden') || 
                    title.includes('sunset') || title.includes('warm')) {
                    return 'warm';
                } else if (tags.includes('blue') || tags.includes('sky') || tags.includes('cool') ||
                           title.includes('blue') || title.includes('sky')) {
                    return 'cool';
                } else if (tags.includes('vibrant') || tags.includes('colorful') || tags.includes('bright') ||
                           title.includes('vibrant') || title.includes('colorful')) {
                    return 'vibrant';
                } else {
                    return 'neutral';
                }
            }

            applyTheme(theme) {
                const container = document.querySelector('.gallery-container');
                const filterContainer = document.querySelector('.filter-container');
                const parallaxLayer = document.getElementById('parallaxLayer');
                
                // Remove existing theme classes
                container.classList.remove('theme-warm', 'theme-cool', 'theme-neutral', 'theme-vibrant');
                filterContainer.classList.remove('theme-warm', 'theme-cool', 'theme-neutral', 'theme-vibrant');
                
                // Apply new theme
                container.classList.add(`theme-${theme}`);
                filterContainer.classList.add(`theme-${theme}`);
                
                // Update parallax background if we have photos
                if (this.photos.length > 0 && parallaxLayer) {
                    const randomPhoto = this.photos[Math.floor(Math.random() * this.photos.length)];
                    parallaxLayer.style.backgroundImage = `url(${randomPhoto.url_m})`;
                    parallaxLayer.classList.add('active');
                }
                
                this.currentTheme = theme;
            }

            updateThemeBasedOnFilter(tag) {
                if (!tag) {
                    // When showing all photos, use a mixed theme
                    this.applyTheme('neutral');
                    return;
                }

                // Analyze the filtered photos to determine theme
                const filteredPhotos = this.photos.filter(photo => photo.tags.includes(tag));
                if (filteredPhotos.length === 0) return;

                const themes = filteredPhotos.map(photo => this.analyzeImageColors(photo));
                const themeCount = themes.reduce((acc, theme) => {
                    acc[theme] = (acc[theme] || 0) + 1;
                    return acc;
                }, {});

                // Apply the most common theme
                const dominantTheme = Object.keys(themeCount).reduce((a, b) => 
                    themeCount[a] > themeCount[b] ? a : b
                );

                if (dominantTheme !== this.currentTheme) {
                    this.applyTheme(dominantTheme);
                }
            }

            // ‚ôø ACCESSIBILITY METHODS

            initAccessibility() {
                this.setupKeyboardNavigation();
                this.setupScreenReaderSupport();
                this.checkUserPreferences();
            }

            setupKeyboardNavigation() {
                // Add tabindex to filter tags for keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Tab') {
                        this.handleTabNavigation(e);
                    } else if (e.key === 'Enter' || e.key === ' ') {
                        this.handleEnterSpacePress(e);
                    } else if (e.key === 'Escape') {
                        this.handleEscape(e);
                    }
                });
            }

            handleTabNavigation(e) {
                // Enhance tab navigation within gallery
                const focusableElements = this.getFocusableElements();
                const currentIndex = focusableElements.indexOf(document.activeElement);
                
                if (e.shiftKey && currentIndex === 0) {
                    // Wrap to last element
                    focusableElements[focusableElements.length - 1].focus();
                    e.preventDefault();
                } else if (!e.shiftKey && currentIndex === focusableElements.length - 1) {
                    // Wrap to first element
                    focusableElements[0].focus();
                    e.preventDefault();
                }
            }

            handleEnterSpacePress(e) {
                const target = e.target;
                if (target.classList.contains('filter-tag')) {
                    target.click();
                    e.preventDefault();
                } else if (target.classList.contains('photo-item')) {
                    target.click();
                    e.preventDefault();
                } else if (target.id === 'closeLightbox') {
                    this.closeLightbox();
                    e.preventDefault();
                }
            }

            handleEscape(e) {
                const lightbox = document.getElementById('lightbox');
                if (lightbox.style.display !== 'none') {
                    this.closeLightbox();
                    e.preventDefault();
                }
            }

            getFocusableElements() {
                return Array.from(document.querySelectorAll(
                    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"]), .filter-tag, .photo-item'
                )).filter(el => !el.disabled && el.offsetParent !== null);
            }

            setupScreenReaderSupport() {
                // Add proper ARIA labels and descriptions
                this.updateAriaLabels();
            }

            updateAriaLabels() {
                // Update filter tags with proper labels
                document.querySelectorAll('.filter-tag').forEach(tag => {
                    const tagName = tag.textContent;
                    tag.setAttribute('role', 'button');
                    tag.setAttribute('aria-label', `Filter by ${tagName}`);
                    tag.setAttribute('tabindex', '0');
                    
                    if (tag.classList.contains('active')) {
                        tag.setAttribute('aria-pressed', 'true');
                    } else {
                        tag.setAttribute('aria-pressed', 'false');
                    }
                });

                // Update photo items with proper labels
                document.querySelectorAll('.photo-item').forEach((item, index) => {
                    const img = item.querySelector('img');
                    if (img) {
                        item.setAttribute('role', 'gridcell');
                        item.setAttribute('tabindex', '0');
                        item.setAttribute('aria-label', `Photo: ${img.alt || 'Untitled'}, press Enter to view larger`);
                    }
                });
            }

            announceToScreenReader(message, priority = 'polite') {
                const region = priority === 'assertive' ? 
                    document.getElementById('ariaStatus') : 
                    document.getElementById('ariaLive');
                
                region.textContent = message;
                
                // Clear the message after it's been announced
                setTimeout(() => {
                    region.textContent = '';
                }, 1000);
            }

            checkUserPreferences() {
                // Check for reduced motion preference
                if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                    this.disableAnimations();
                }

                // Check for high contrast preference
                if (window.matchMedia('(prefers-contrast: high)').matches) {
                    this.enableHighContrastMode();
                }

                // Check for dark mode preference
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    this.applyDarkMode();
                }
            }

            disableAnimations() {
                document.body.classList.add('reduced-motion');
                this.announceToScreenReader('Animations disabled for better accessibility');
            }

            enableHighContrastMode() {
                document.body.classList.add('high-contrast');
                this.announceToScreenReader('High contrast mode activated');
            }

            applyDarkMode() {
                document.body.classList.add('dark-mode');
            }

            updateAccessibilityOnFilter(tag, resultCount) {
                const message = tag ? 
                    `Filtered by ${tag}, showing ${resultCount} photos` : 
                    `Showing all ${resultCount} photos`;
                
                this.announceToScreenReader(message);
                this.updateAriaLabels();
            }
        }

        // Initialize the gallery when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            // Force dark mode immediately
            document.body.classList.add('dark-mode');
            
            new FlickrGallery();
        });
    </script>
</body>
</html>